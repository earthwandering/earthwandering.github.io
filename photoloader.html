---
layout: basic_bs
title:  Earth Wandering Photo Loader Tool
flickrkey: 2105c3f58a7d85488a10f2db6c151be1
flickrsecret: 49c062ce5df1d77f 
flickruserid: 100330886@N04
samplephotoset: 72157635232920260
---


<script type="text/javascript">
var flickrbase = 'http://api.flickr.com/services/rest/?jsoncallback=?';
var pagelog = null;
var output = null;

$(document).ready(function() {
	pagelog = $("#pagelog");
	output = $("#output");
	
	//pagelog.append("Starting page load\n");
	//loadPhotosets();
	//pagelog.append("Done with page load\n");
});

function getStarted() {
	$("#userlabel").append(getUserId());	
	$("#input_linkoptions").show("slow", function() {
		$("#output").show();
		$("#results_area").show();
		$("#log_area").show();
		loadPhotosets();
	});
}

function getUserId() {
	return $("#input_flickruserid").val();
}

function getOptionData() {
	var optiondata = {
		user: getUserId(),
		size: $("#input_imgsize").val(),
		includeimg: ($("#input_includeimg").is( ":checked" )),
		imgclass: $("#input_imgclass").val(),
		includelink: ($("#input_includelink").is( ":checked" )),
		linkclass: $("#input_linkclass").val(),
		showsetpreview: ($("#input_showsetpreview").is( ":checked" ))	
	};
	
	pagelog.append("Option Data: " + JSON.stringify(optiondata) + "\n");
	
	return optiondata;
}

function getPreviewOptionData() {
	var optiondata = {
		user: getUserId(),
		size: "s",
		includeimg: true,
		imgclass: "previewphoto",
		includelink: true,
		linkclass: "previewlink",
		showsetpreview: true	
	};
	
	pagelog.append("Option Data: " + JSON.stringify(optiondata) + "\n");
	
	return optiondata;
}

function loadPhotosets() {
	var flickruserid = getUserId();
	pagelog.append("Loading photosets for user: " + flickruserid + "\n");
	var flickrargs = {format:'json', api_key: '{{page.flickrkey}}', user_id: flickruserid, method: 'flickr.photosets.getList'};	

	$.getJSON(flickrbase, flickrargs, function(data) {		
		pagelog.append("photoset data:\n" + JSON.stringify(data) + "\n\n");
		
		$.each(data.photosets.photoset, function(index, setdata) {
			var seturl = getSetUrl(setdata.id);
			var settitle = setdata.title._content;
			console.log("inputs: " + seturl + ", " + settitle);
			var setlink = getLinkHtml(seturl, settitle);

			pagelog.append("photoset: " + index + ":" + settitle + " " + setlink + " - " + setdata.id + JSON.stringify(setdata) + "\n");

			//loadPhotosetPhotos(setdata.id);
			
			output.append('<div id="setdiv' + setdata.id + '">')
			output.append('<input type="button" class="setloadbutton" onclick="loadPhotosetPhotos(\'' + setdata.id + '\')" value="load" />');
			output.append("<strong>" + setlink + "</strong>");
			output.append('<span id="setspan' + setdata.id + '"></span>');
			output.append('</div>');	
		});
		
		pagelog.append("Done iterating over data\n");
		
	});
}

function loadPhotosetPhotos(photosetid) {
	var flickrargs = {format:'json', api_key: '{{page.flickrkey}}', user_id: '{{page.flickruserid}}', photoset_id: photosetid, method: 'flickr.photosets.getPhotos'};	

	var imgsize = $("#input_imgsize").val();

	pagelog.append("photos (set:" + photosetid + ")\n");
	
	var optiondata = getOptionData();
	var previewoptiondata = getPreviewOptionData();

	var setspan = $('#setspan' + photosetid)
	setspan.html("");
	
	if (optiondata.showsetpreview) {
		setspan.append('<div id="setpreview' + photosetid + '"></div>');
	}
	
	setspan.append('<pre id="setpre' + photosetid + '"></pre>');
	
	$.getJSON(flickrbase, flickrargs, function(data) {		
		pagelog.append("photos data:" + JSON.stringify(data) + "\n");

		var settarget = $('#setpre' + photosetid);
		var setpreviewtarget = $('#setpre' + photosetid);
		
		$.each(data.photoset.photo, function(index, photodata) {
			pagelog.append("photo: " + JSON.stringify(photodata) + "\n");
		
			settarget.append(getImageHtml(optiondata, photodata, photosetid));
			settarget.append("\n");

			if (optiondata.showsetpreview) {
				setpreviewtarget.before(getImagePreviewHtml(previewoptiondata, photodata, photosetid));
			}
			
		});
	});
}

function getImagePreviewHtml(optiondata, photodata, photosetid) {
	var result = getImageHtml(optiondata, photodata, photosetid);
	result = result.replace(/&gt;/g,">");
	result = result.replace(/&lt;/g, "<");
	console.log("preview image link: " + result);
	return result;
}

function getImageHtml(optiondata, photodata, photosetid) {
	//photodata.id, photodata.farm, photodata.server, photodata.secret, imgsize
	var html="";
	
	if (optiondata.includelink) {
		var flickrUrl = getImageFlickrUrl(optiondata.user, photodata.id, photosetid);
		html += '&lt;a';
		if (optiondata.linkclass != "") {
			html += ' class="' + optiondata.linkclass + '"';
		}
		html += ' href="' + flickrUrl + '"&gt;';
	}

	var imageUrl = getImageUrl(optiondata, photodata);
	if (optiondata.includeimg) {
		html += '&lt;img';
		if (optiondata.imgclass != "") {
			html += ' class="' + optiondata.imgclass + '"';
		}
		html += ' title="' + photodata.title + '" src="' + imageUrl + '"&gt;';
	} else {
		html += imageUrl;
	}
	
	if (optiondata.includelink) {	
		html += '&lt;/a&gt;';
	}
	
	return html;
}

function getImageUrl(optiondata, photodata) {
	//http://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg
	//from http://www.flickr.com/services/api/misc.urls.html	

	var url = "http://farm" + photodata.farm + ".staticflickr.com/" + photodata.server + "/" + photodata.id + "_" + photodata.secret
	if (optiondata.size == "") {
		return url + ".jpg";
	} else {
		return url + "_" + optiondata.size + ".jpg";
	}	
}

function getImageFlickrUrl(userId, imageId, setId) {
	//http://www.flickr.com/photos/100330886@N04/9594249168/in/set-72157635232920260
	var url = "http://www.flickr.com/photos/" + userId + "/" + imageId + "/in/set-" + setId;
	return url
}

function getSetUrl(setId) {
	console.log("getSetUrl(" + setId + ")");
	var out = "http://www.flickr.com/photos/{{page.flickruserid}}/sets/" + setId;
	console.log("set url: " + out);
	return out + ""
}

function getSetLoadButton(setId) {
	//loadPhotosetPhotos(itemdata.id);
}

function getLinkHtml(urlstring, text) {
	console.log("getLinkHtml(" + urlstring + ", " + text + ")");
	var out = '<a href="' + urlstring + '">' + text + '</a>';
	console.log(out);
	return out;
}

function clearLog() {
	$("#pagelog").html("");
}


</script>

<div id="input_user">

	<fieldset>
		<label for="input_flickruserid">Flickr User Id</label>
		<input id="input_flickruserid" type="text" class="form-control" value="{{page.flickruserid}}" />
		<input type="button" onclick="getStarted()" value="Load Flickr Sets" class="form-control" />
	</fieldset>
</div>

<div id="input_linkoptions" style="display: none;">
	<h2>Image Link Options</h2>
	
	<fieldset>
	<div>
		<label for="input_imgsize">Flickr Image Size</label>
		<select id="input_imgsize">		
			<option value="s">small square 75x75</option>
			<option value="q">large square 150x150</option>
			<option value="t">thumbnail, 100 on longest side</option>
			<option value="m">small, 240 on longest side</option>
			<option value="n">small, 320 on longest side</option>
			<option value="" selected="selected">medium, 500 on longest side</option>
			<option value="z">medium 640, 640 on longest side</option>
			<option value="c">medium 800, 800 on longest side</option>
			<option value="b">large, 1024 on longest side</option>
			<!--
			<option value="o">original image, either a jpg, gif or png, depending on source format</option>
			-->		
		</select>	
	</div>
	<div>
		<input id="input_includeimg" type="checkbox" checked="checked" />
		<label for="input_includeimg">Render Image Tag</a>

		(<label for="input_imgclass">img tag class:</label>
		<input id="input_imgclass" type="text" value="photo" size="10" />)
		
	</div>

	<div>
		<input id="input_includelink" type="checkbox" checked="checked" />
		<label for="input_includelink">Render Link Around Images</a>
		
		(<label for="input_linkclass">link class:</label>
		<input id="input_linkclass" type="text" value="photo-link" size="10" />)

	</div>

	<div>
		<input id="input_showsetpreview" type="checkbox" checked="checked" />
		<label for="input_showsetpreview">Show Set Preview</a>
	</div>

	</fieldset>
</div>

<div id="results_area" style="display: none;">
	<div id="output">
		<h2>Flickr Sets For User <span id="userlabel"></span><h2>
	</div>
</div>

<div id="log_area" style="display: none;">
	<h2>Page Activity Log <input type="button" onclick="clearLog()" value="Clear" /></h2>
<pre id="pagelog"></pre>
</div